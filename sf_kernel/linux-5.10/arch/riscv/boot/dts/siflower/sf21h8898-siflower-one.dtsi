/*
 * Copyright 2022 SiFlower Corporation.
 */

#include "sf21h8898.dtsi"

/ {
	model = "siflower sf21h8898 bpi evaluation board";
	compatible = "siflower,sf21h8898-bpi-nand", "siflower,sf21h8898";

	chosen {
		stdout-path = "serial1:115200n8";
	};

	memory@20000000 {
		device_type = "memory";
		reg = <0x0 0x20000000 0x0 0x20000000>;
	};

	leds {
		compatible = "gpio-leds";

		led_status: led-status {
			label = "status:blue";
			gpios = <&gpio 1 GPIO_ACTIVE_LOW>;
		};
	};

	keys {
		compatible = "gpio-keys";
		pinctrl-names = "default";
		pinctrl-0 = <&rstbtn_pin>;

		reset {
			label = "reset";
			linux,code = <KEY_RESTART>;
			gpios = <&gpio 29 GPIO_ACTIVE_LOW>;
		};
	};

	usb_vbus: regulator@0 {
		compatible = "regulator-fixed";
		regulator-name = "usb_vbus";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		gpio = <&gpio 37 GPIO_ACTIVE_HIGH>;
		enable-active-high;
	};
};

&spi0_pins {
	pinctrl-single,pins = <
		SPI0_TXD	FUNC_MODE0
		SPI0_RXD	FUNC_MODE0
		SPI0_CLK	FUNC_MODE0
		SPI0_HOLD	FUNC_MODE0
		SPI0_WP		FUNC_MODE0
	>;
};

&pvt {
	status = "okay";
};

&pcie0 {
	reset-gpios = <&gpio 31 GPIO_ACTIVE_LOW>;
	reset-ms = <100>;
	num-lanes = <1>;
	lane-mode = <0>;
	status = "okay";
};

&pcie1 {
	reset-gpios = <&gpio 33 GPIO_ACTIVE_LOW>;
	reset-ms = <100>;
	num-lanes = <1>;
	lane-mode = <0>;
	status = "okay";
};

&watchdog {
	status = "okay";
};

&uart1 {
	status = "okay";
};

&spi0 {
	status = "okay";
	num-cs = <2>;
	cs-gpios = <&gpio 5 GPIO_ACTIVE_LOW>, <&gpio 36 GPIO_ACTIVE_LOW>;
};

&iomux {
	rtc_int_gpio: rtc-int-pins {
		pinctrl-single,pins = <PHY_INT GPIO_MODE>;
		// disable internal bias as it's externally (and weakly) pulled up
		pinctrl-single,bias-pullup = <0 SW_PU 0 SW_PU>;
		pinctrl-single,bias-pulldown = <0 SW_PD 0 SW_PD>;
	};

	rstbtn_pin: rstbtn_pin {
		pinctrl-single,pins = <RGMII_RXD0 GPIO_MODE>;
		pinctrl-single,bias-pullup = <SW_PU SW_PU 0 SW_PU>;
		pinctrl-single,bias-pulldown = <0 SW_PD 0 SW_PD>;
	};
};

&i2c0 {
	status = "okay";

	rtc: rtc@51 {
		compatible = "analogtek,at8563", "nxp,pcf8563";
		reg = <0x51>;
		#clock-cells = <0>;
		interrupts-extended = <&gpio 40 IRQ_TYPE_LEVEL_LOW>;
		pinctrl-names = "default";
		pinctrl-0 = <&rtc_int_gpio>;
	};
};

&xgmac0 {
	status = "okay";
	phy-handle = <&sfphy0>;
	nvmem-cells = <&mtd_mac_address>;
	nvmem-cell-names = "mac-address";
};

&xgmac1 {
	status = "okay";
	phy-handle = <&sfphy1>;
	nvmem-cells = <&mtd_mac_address>;
	nvmem-cell-names = "mac-address";
};

&xgmac2 {
	status = "okay";
	phy-handle = <&sfphy2>;
	nvmem-cells = <&mtd_mac_address>;
	nvmem-cell-names = "mac-address";
};

&xgmac3 {
	status = "okay";
	phy-handle = <&sfphy3>;
	nvmem-cells = <&mtd_mac_address>;
	nvmem-cell-names = "mac-address";
};

&xgmac4 {
	status = "okay";
	phy-handle = <&ytphy>;
	nvmem-cells = <&mtd_mac_address>;
	nvmem-cell-names = "mac-address";
	mac-address-increment = <1>;
	/delete-property/ pinctrl-0;
};

&mdio0 {
	reset-gpios = <&gpio 30 GPIO_ACTIVE_LOW>;
	reset-delay-us = <10000>;
	reset-post-delay-us = <100000>;

	sfphy0: ethernet-phy@1 {
		compatible = "ethernet-phy-idadb4.0411";
		reg = <0x1>;
	};

	sfphy1: ethernet-phy@2 {
		compatible = "ethernet-phy-idadb4.0411";
		reg = <0x2>;
	};

	sfphy2: ethernet-phy@3 {
		compatible = "ethernet-phy-idadb4.0411";
		reg = <0x3>;
	};

	sfphy3: ethernet-phy@4 {
		compatible = "ethernet-phy-idadb4.0411";
		reg = <0x4>;
	};

	ytphy: ethernet-phy@7 {
		compatible = "ethernet-phy-id4f51.ea19";
		reg = <0x7>;
		reset-gpios = <&gpio 39 GPIO_ACTIVE_LOW>;
		reset-assert-us = <10000>;
		reset-deassert-us = <100000>;
	};
};

&usb_phy {
	status = "okay";
};

&usb {
	status = "okay";
	vbus-supply = <&usb_vbus>;
};

&dpns {
	status = "okay";
};

&edma {
	status = "okay";
};

&qsgmii_pcs {
	status = "okay";
};

&sgmii_pcs {
	status = "okay";
};

&crypto {
	status = "okay";
};
